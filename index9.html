<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
    <title>Otro Mundo | Colecci칩n</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #25d366;
            --primary-light: #90ee90;
            --primary-dark: #2d5a27;
            --accent: #ffbb3b;
            --bg: #f8fff8;
            --modal-bg: rgba(22,28,23,0.92);
            --modal-card-bg: #1c2320;
            --modal-card-radius: 24px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Quicksand', Arial, sans-serif;
            color: #222;
            background: linear-gradient(135deg, #f8fff8 0%, #e2ffe3 100%);
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        header {
            background: rgba(255,255,255,0.92);
            backdrop-filter: blur(12px);
            color: var(--primary-dark);
            position: fixed; top: 0; width: 100vw; z-index: 1000;
            box-shadow: 0 4px 24px #25d36618;
            border-bottom: 2px solid #90ee9035;
        }
        nav {
            display: flex; justify-content: space-between; align-items: center; min-height: 64px;
        }
        .logo {
            font-family: 'Pacifico', cursive;
            font-size: 1.7rem; font-weight: 900; letter-spacing: 1px;
            color: var(--primary-dark);
            display: flex; align-items: center; gap: 10px;
            user-select: none;
        }
        .logo::before {
            content: "游뿺";
            font-size: 2.1rem;
            margin-right: 5px;
        }
        .nav-links {
            display: flex; list-style: none; gap: 2rem; align-items: center;
            background: rgba(255,255,255,0.10); padding: 6px 20px; border-radius: 1.7rem;
        }
        .nav-links a {
            font-family: 'Quicksand', sans-serif;
            color: var(--primary-dark); text-decoration: none; font-weight: 700;
            font-size: 1.12rem; letter-spacing: .6px;
            padding: 8px 19px; border-radius: 1.5rem; transition: color .20s, background .18s;
        }
        .nav-links a:hover, .nav-links a.active {
            color: #fff;
            background: linear-gradient(90deg, var(--primary) 40%, var(--primary-light) 100%);
            box-shadow: 0 2px 10px #25d3662d;
            transform: scale(1.05) translateY(-1px);
        }
        .hamburger {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 32px; height: 28px;
            cursor: pointer;
            z-index: 1001;
        }
        .hamburger span {
            width: 100%;
            height: 3px;
            background-color: var(--primary-dark);
            border-radius: 2px;
            margin: 3px 0;
            transition: all 0.3s;
        }
        .hamburger.active span:nth-child(1) { transform: translateY(8px) rotate(45deg); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }
        @media (max-width: 700px) {
            nav { min-height: 54px; }
            .logo { font-size: 1.15rem; }
            .nav-links {
                flex-direction: column;
                gap: 0.6rem;
                background: rgba(255,255,255,0.97);
                position: fixed;
                top: 54px;
                right: -100vw;
                width: 100vw;
                z-index: 999;
                box-shadow: 0 8px 24px #25d36618;
                border-radius: 0 0 18px 18px;
                padding: 18px 0 18px 0;
                transition: right 0.3s;
            }
            .nav-links.active { right: 0; }
            .nav-links a {
                width: 95%;
                margin: 0 auto;
                text-align: center;
                font-size: 1.07rem;
                padding: 13px 0;
                border-radius: 1.2rem;
            }
            .hamburger { display: flex; }
        }
        .section-title {
            text-align: center; font-size: 2rem; color: #2d5a27; margin-bottom: 2rem;
            font-family: 'Pacifico', cursive; font-weight: bold; letter-spacing: .07em;
        }
        .products-section {
            padding: 110px 0 30px 0;
        }
        .products-grid {
            display: grid; grid-template-columns: 1fr; gap: 2.2rem; margin-top: 1.5rem;
        }
        @media (min-width: 700px) {
            .products-grid { grid-template-columns: repeat(auto-fit, minmax(290px, 1fr)); }
        }
        .product-card {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.07);
            padding: 2rem 1rem 1.3rem 1rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        .product-image {
            width: 100%;
            max-width: 440px;
            height: 340px;
            overflow: hidden;
            border-radius: 18px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 12px #25d36617;
            position: relative;
            background: #f8fff8;
            cursor: zoom-in;
        }
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 18px;
            transition: transform 0.35s cubic-bezier(.42,.01,.62,1.14), filter 0.25s;
            will-change: transform;
            display: block;
        }
        .about-section { background: #f8fff8; }
        .descripcion {
            margin-bottom: 1em;
            color: #444;
            font-size: 1em;
            text-align: left;
            line-height: 1.5;
            position: relative;
        }
        .leer-mas-btn {
            display: inline-block;
            color: var(--primary-dark);
            background: none;
            border: none;
            font-weight: 700;
            cursor: pointer;
            font-size: 1em;
            padding: 0 0.3em;
            margin-top: 4px;
            transition: color 0.15s;
            text-decoration: underline dotted;
        }
        .leer-mas-btn:hover { color: var(--primary); }
        /* MODAL MODERN STYLES */
        .modal-overlay {
            display: none;
            position: fixed;
            z-index: 12000;
            left: 0; top: 0; width: 100vw; height: 100vh;
            background: var(--modal-bg);
            justify-content: center;
            align-items: center;
            transition: background 0.25s;
        }
        .modal-overlay.active { display: flex; animation: modalFadeIn .22s cubic-bezier(.42,.01,.62,1.14); }
        @keyframes modalFadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content {
            background: var(--modal-card-bg);
            border-radius: var(--modal-card-radius);
            box-shadow: 0 16px 50px #000b, 0 2px 7px #25d36655;
            max-width: 99vw;
            max-height: 94vh;
            width: 540px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 26px 0 20px 0;
            animation: modalCardPop .20s cubic-bezier(.42,.01,.62,1.14);
        }
        @keyframes modalCardPop { from { transform: scale(.93); opacity: 0.6; } to { transform: scale(1); opacity: 1; } }
        .modal-close {
            position: absolute;
            top: 15px; right: 20px;
            background: #1c2320;
            color: #fff;
            border: none;
            font-size: 2.2rem;
            font-weight: 800;
            border-radius: 50%;
            width: 44px; height: 44px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px #2d5a271a;
            z-index: 100;
            transition: background .18s, color .18s, transform .15s;
        }
        .modal-close:hover { background: #25d366; color: #1c2320; transform: scale(1.08);}
        .modal-title {
            margin-bottom: 12px;
            font-size: 1.38em;
            font-weight: bold;
            color: #fff;
            letter-spacing: 0.03em;
            text-align: center;
        }
        .modal-slider {
            width: 100%;
            max-width: 420px;
            height: 370px;
            margin: 0 auto 1.6em auto;
            overflow: hidden;
            position: relative;
            border-radius: 19px;
            background: #e2ffe3;
            box-shadow: 0 8px 20px #25d36614;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: none;
        }
        .modal-slider-img {
            width: 100%;
            height: 100%;
            object-fit: contain !important;
            border-radius: 19px;
            background: #f8fff8;
            transition: opacity 0.3s, transform 0.25s cubic-bezier(.42,.01,.62,1.14);
            box-shadow: 0 2px 12px #25d36617;
            pointer-events: all;
            user-select: none;
            cursor: zoom-in;
            will-change: transform;
            image-rendering: auto;
        }
        .modal-slider-img.zoomed {
            cursor: grab;
            z-index: 10;
        }
        .slider-arrow {
            position: absolute;
            top: 50%; transform: translateY(-50%);
            background: #fff;
            border: none;
            border-radius: 50%;
            width: 44px; height: 44px;
            font-size: 2.1em;
            color: #25d366;
            cursor: pointer;
            box-shadow: 0 2px 8px #25d36622;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s, color 0.2s, transform 0.14s;
            opacity: 0.92;
        }
        .slider-arrow:active { background: #d8ffd8; color: #1c2320; transform: scale(1.06);}
        .slider-arrow.left { left: 5px; }
        .slider-arrow.right { right: 5px; }
        .modal-slider-count {
            position: absolute;
            bottom: 0; right: 16px;
            color: #fff;
            background: #25d366cc;
            font-size: 1em;
            border-radius: 10px 10px 0 0;
            padding: 3px 14px 2px 14px;
            font-weight: 600;
            pointer-events: none;
            box-shadow: 0 2px 6px #0d2a007a;
        }
        .modal-desc {
            color: #e4ffe3;
            background: #20312766;
            font-size: 1.08em;
            border-radius: 12px;
            padding: 13px 18px 9px 18px;
            margin-bottom: 2px;
            margin-top: 7px;
            text-align: left;
            font-family: 'Quicksand', sans-serif;
            line-height: 1.55;
            max-width: 81vw;
        }
        @media (max-width: 700px) {
            .modal-content { width: 98vw; }
            .modal-slider { max-width: 97vw; height: 54vw; min-height:180px;}
            .modal-desc { font-size:1em; padding:11px 9px 8px 13px;}
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <div class="logo">Otro Mundo</div>
            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul class="nav-links" id="navLinks">
                <li><a href="#coleccion" class="active">Colecci칩n</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section class="products-section" id="coleccion">
            <div class="container">
                <h2 class="section-title">Colecci칩n</h2>
                <div class="products-grid" id="productsGrid"></div>
            </div>
        </section>
        <div id="modalOverlay" class="modal-overlay" tabindex="-1">
            <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
                <button class="modal-close" id="modalCloseBtn" aria-label="Cerrar vista de im치genes">&times;</button>
                <div class="modal-title" id="modalTitle"></div>
                <div class="modal-slider" id="modalSlider">
                    <button class="slider-arrow left" id="sliderPrev" aria-label="Anterior">&#8592;</button>
                    <img src="" alt="" class="modal-slider-img" id="modalSliderImg">
                    <button class="slider-arrow right" id="sliderNext" aria-label="Siguiente">&#8594;</button>
                    <div class="modal-slider-count" id="modalSliderCount"></div>
                </div>
                <div class="modal-desc" id="modalDesc"></div>
            </div>
        </div>
    </main>
    <script>
    const suculentas = [
        {
            nombre: "El Cactus Cacahuete",
            archivo: "cactuscacahuete.jpg",
            descripcion: "Un cactus peque침o y peculiar, ideal para principiantes. Tolera la sequ칤a y requiere mucha luz natural.",
            fotos: [
                "cactuscacahuete.jpg",
                "cactuscacahuete-2.jpg",
                "cactuscacahuete-3.jpg"
            ]
        },
        {
            nombre: "Echeveria Elegans",
            archivo: "echeveria-elegans.jpg",
            descripcion: `Famosa por su forma de roseta y color suave.
Necesita riego moderado y evita el exceso de humedad en las hojas.
Esta variedad es perfecta para quienes buscan una planta resistente y decorativa.
Su belleza radica en la simplicidad y la elegancia de sus hojas, que forman una espiral casi perfecta.
Incluso en espacios reducidos, puede aportar mucha vida y color.`,
            fotos: [
                "echeveria-elegans.jpg",
                "echeveria-elegans-2.jpg"
            ]
        },
        {
            nombre: "Graptosedum 'California Sunset'",
            archivo: "califonissunset.jpg",
            descripcion: `Sus hojas cambian de color seg칰n la luz. Riego escaso y mucho sol para resaltar sus tonos naranjas. 
춰Ideal para sumar un toque de color al jard칤n o balc칩n!
Si se la coloca cerca de una ventana soleada, sus puntas se tornan rojizas, creando un efecto espectacular.`,
            fotos: [
                "califonissunset.jpg",
                "califonissunset-2.jpg"
            ]
        },
        {
            nombre: "Huernia Ojo de Drag칩n",
            archivo: "ojodedragon.jpg",
            descripcion: `Es una suculenta nativa de 츼frica con tallos carnosos y flores con forma de estrella de aspecto ex칩tico, que parecen un peque침o drag칩n. 
Requiere luz abundante y riego moderado. Es muy resistente y de f치cil reproducci칩n.`,
            fotos: [
                "ojodedragon.jpg",
                "ojodedragon-2.jpg"
            ]
        },
        {
            nombre: "Callisia Navicularis",
            archivo: "callisianavicularis.jpg",
            descripcion: `Planta rastrera de hojas carnosas y peque침as. Ideal para cubrir macetas o como planta colgante. 
Prefiere semisombra y riegos frecuentes en verano.`,
            fotos: [
                "callisianavicularis.jpg"
            ]
        },
        {
            nombre: "Cactus Coral o Cactus Arroz",
            archivo: "cactuscoral.jpg",
            descripcion: `Cactus de crecimiento lento, muy ornamental por sus tallos cil칤ndricos que recuerdan a granos de arroz.
Tolera largos periodos sin agua y le gusta el sol directo.`,
            fotos: [
                "cactuscoral.jpg"
            ]
        },
        {
            nombre: "Madre perla",
            archivo: "madreperla.jpg",
            descripcion: `Conocida por sus hojas plateadas en forma de roseta. Muy resistente, necesita poco riego y mucho sol para lucir sus colores nacarados.`,
            fotos: [
                "madreperla.jpg"
            ]
        },
        {
            nombre: "Mammillaria vetula",
            archivo: "mammillariavetula.jpg",
            descripcion: `Cactus peque침o, globoso y cubierto de espinas suaves. Florece en primavera con peque침as flores rosadas o blancas. 
Ideal para macetas peque침as y colecciones.`,
            fotos: [
                "mammillariavetula.jpg"
            ]
        },
        {
            nombre: "Mammillaria prolifera",
            archivo: "mammillariaprolifera.jpg",
            descripcion: `Cactus que forma grupos de peque침as cabezas. Sus flores son blancas y produce frutos rojos muy decorativos. 
De f치cil cultivo y r치pido crecimiento.`,
            fotos: [
                "mammillariaprolifera.jpg"
            ]
        },
        {
            nombre: "Crassula expansa subsp. fragilis",
            archivo: "crassulafragilis.jpg",
            descripcion: "Planta de porte bajo con tallos finos y delicados. Prefiere ambientes luminosos y riegos controlados.",
            fotos: [
                "crassulafragilis.jpg"
            ]
        },
        {
            nombre: "Opuntia monacantha variegada monstruosa",
            archivo: "monstruosa.jpg",
            descripcion: `Variedad muy decorativa y poco com칰n. Sus formas irregulares y coloraci칩n la hacen 칰nica en cualquier colecci칩n.
Puede alcanzar un tama침o considerable y requiere espacio para lucirse.
Sus espinas son peque침as, pero se recomienda manipularla con cuidado.`,
            fotos: [
                "monstruosa.jpg"
            ]
        }
    ];

    function createDescripcionHTML(desc, maxChars=120) {
        if(desc.length <= maxChars) return `<span>${desc}</span>`;
        const corto = desc.slice(0, maxChars);
        return `<span class="desc-corta">${corto}...</span>
            <span class="desc-larga" style="display:none;">${desc}</span>
            <button class="leer-mas-btn" type="button">Leer m치s</button>`;
    }
    function renderProductos() {
        const grid = document.getElementById('productsGrid');
        grid.innerHTML = '';
        suculentas.forEach((prod, idx) => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <div class="product-image" data-index="${idx}" tabindex="0" aria-label="Ver m치s fotos ${prod.nombre}">
                    <img src="img/suculentas/${prod.archivo}" alt="${prod.nombre}" loading="lazy">
                </div>
                <h3>${prod.nombre}</h3>
                <p class="descripcion">${createDescripcionHTML(prod.descripcion)}</p>
            `;
            grid.appendChild(card);
        });

        document.querySelectorAll('.product-image').forEach(container => {
            const img = container.querySelector('img');
            let zoomed = false;
            let scale = 2.1;
            container.addEventListener('mouseenter', e => {
                img.style.transform = `scale(${scale})`;
                img.style.filter = "brightness(1.05) contrast(1.06)";
                container.classList.add('zoomed');
                zoomed = true;
            });
            container.addEventListener('mouseleave', e => {
                img.style.transform = "scale(1)";
                img.style.filter = "";
                container.classList.remove('zoomed');
                img.style.transformOrigin = "center center";
                zoomed = false;
            });
            container.addEventListener('mousemove', e => {
                if(!zoomed) return;
                const rect = container.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                img.style.transformOrigin = `${x}% ${y}%`;
            });
            container.addEventListener('click', function() {
                const idx = parseInt(container.getAttribute('data-index'), 10);
                openModalGallery(idx);
            });
            container.addEventListener('keypress', function(e) {
                if (e.key === "Enter" || e.key === " ") {
                    const idx = parseInt(container.getAttribute('data-index'), 10);
                    openModalGallery(idx);
                }
            });
        });

        document.querySelectorAll('.leer-mas-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const p = btn.closest('.descripcion');
                const corta = p.querySelector('.desc-corta');
                const larga = p.querySelector('.desc-larga');
                if(btn.textContent === "Leer m치s") {
                    corta.style.display = "none";
                    larga.style.display = "inline";
                    btn.textContent = "Leer menos";
                } else {
                    corta.style.display = "inline";
                    larga.style.display = "none";
                    btn.textContent = "Leer m치s";
                }
            });
        });
    }
    renderProductos();

    // --- MODAL SLIDER & ZOOM REAL ---
    let currentModalIdx = 0;
    let currentPhotoIdx = 0;
    function openModalGallery(plantaIdx) {
        const modal = document.getElementById('modalOverlay');
        const modalTitle = document.getElementById('modalTitle');
        const modalImg = document.getElementById('modalSliderImg');
        const sliderCount = document.getElementById('modalSliderCount');
        const modalDesc = document.getElementById('modalDesc');
        const planta = suculentas[plantaIdx];
        currentModalIdx = plantaIdx;
        currentPhotoIdx = 0;
        modalTitle.textContent = planta.nombre;
        modalDesc.textContent = planta.descripcion;
        updateModalSlider();
        modal.classList.add('active');
        document.body.style.overflow = "hidden";
        setTimeout(()=>{document.getElementById('modalCloseBtn').focus()}, 250);
        resetModalZoom();
    }
    function closeModalGallery() {
        document.getElementById('modalOverlay').classList.remove('active');
        document.body.style.overflow = "";
        resetModalZoom();
    }
    function updateModalSlider() {
        const planta = suculentas[currentModalIdx];
        const modalImg = document.getElementById('modalSliderImg');
        const sliderCount = document.getElementById('modalSliderCount');
        modalImg.style.opacity = "0.5";
        setTimeout(()=>{
            modalImg.src = "img/suculentas/" + planta.fotos[currentPhotoIdx];
            modalImg.alt = planta.nombre + " foto " + (currentPhotoIdx+1);
            sliderCount.textContent = (currentPhotoIdx+1) + " / " + planta.fotos.length;
            modalImg.style.opacity = "1";
            resetModalZoom();
        }, 80);
    }
    document.getElementById('modalCloseBtn').onclick = closeModalGallery;
    document.getElementById('sliderPrev').onclick = () => {
        const planta = suculentas[currentModalIdx];
        currentPhotoIdx = (currentPhotoIdx - 1 + planta.fotos.length) % planta.fotos.length;
        updateModalSlider();
    };
    document.getElementById('sliderNext').onclick = () => {
        const planta = suculentas[currentModalIdx];
        currentPhotoIdx = (currentPhotoIdx + 1) % planta.fotos.length;
        updateModalSlider();
    };

    // --- ZOOM Y PAN EN MODAL SLIDER ---
    let zoomed = false, offsetX = 0, offsetY = 0, startX = 0, startY = 0, panStart = null;
    const modalImg = document.getElementById('modalSliderImg');
    const modalSlider = document.getElementById('modalSlider');
    let scale = 1, maxScale = 1, naturalW = 1, naturalH = 1, displayW = 1, displayH = 1;

    function resetModalZoom() {
        zoomed = false;
        offsetX = offsetY = 0;
        if (modalImg) {
            modalImg.classList.remove('zoomed');
            modalImg.style.transform = "scale(1)";
            modalImg.style.cursor = "zoom-in";
            modalImg.style.transition = "transform 0.25s";
        }
    }
    function setZoomModal() {
        naturalW = modalImg.naturalWidth;
        naturalH = modalImg.naturalHeight;
        displayW = modalSlider.offsetWidth;
        displayH = modalSlider.offsetHeight;
        let scaleW = naturalW / displayW;
        let scaleH = naturalH / displayH;
        maxScale = Math.max(scaleW, scaleH, 1);
        scale = maxScale;
    }
    modalImg.onload = function() {
        resetModalZoom();
        setZoomModal();
    };
    window.addEventListener('resize', function() {
        setZoomModal();
        if (zoomed) modalImg.style.transform = `scale(${scale}) translate(0px,0px)`;
    });
    modalImg.addEventListener('click', function(e) {
        if (!zoomed) {
            setZoomModal();
            zoomed = true;
            modalImg.classList.add('zoomed');
            modalImg.style.transform = `scale(${scale})`;
            modalImg.style.cursor = "grab";
            modalImg.style.transition = "transform 0.25s";
            offsetX = offsetY = 0;
        } else {
            resetModalZoom();
        }
    });
    modalSlider.addEventListener('mousedown', function(e){
        if (!zoomed) return;
        e.preventDefault();
        startX = e.clientX - offsetX;
        startY = e.clientY - offsetY;
        document.body.style.cursor = 'grabbing';
        function mousemove(ev) {
            offsetX = ev.clientX - startX;
            offsetY = ev.clientY - startY;
            const maxPanX = ((modalImg.naturalWidth * scale / maxScale) - displayW) / 2;
            const maxPanY = ((modalImg.naturalHeight * scale / maxScale) - displayH) / 2;
            offsetX = Math.max(Math.min(offsetX, maxPanX), -maxPanX);
            offsetY = Math.max(Math.min(offsetY, maxPanY), -maxPanY);
            modalImg.style.transform = `scale(${scale}) translate(${offsetX/scale}px,${offsetY/scale}px)`;
        }
        function mouseup() {
            document.removeEventListener('mousemove', mousemove);
            document.removeEventListener('mouseup', mouseup);
            document.body.style.cursor = '';
        }
        document.addEventListener('mousemove', mousemove);
        document.addEventListener('mouseup', mouseup);
    });
    modalSlider.addEventListener('touchstart', function(e){
        if (!zoomed || e.touches.length !== 1) return;
        e.preventDefault();
        panStart = {x: e.touches[0].clientX - offsetX, y: e.touches[0].clientY - offsetY};
    });
    modalSlider.addEventListener('touchmove', function(e){
        if (!zoomed || !panStart || e.touches.length !== 1) return;
        e.preventDefault();
        offsetX = e.touches[0].clientX - panStart.x;
        offsetY = e.touches[0].clientY - panStart.y;
        const maxPanX = ((modalImg.naturalWidth * scale / maxScale) - modalSlider.offsetWidth) / 2;
        const maxPanY = ((modalImg.naturalHeight * scale / maxScale) - modalSlider.offsetHeight) / 2;
        offsetX = Math.max(Math.min(offsetX, maxPanX), -maxPanX);
        offsetY = Math.max(Math.min(offsetY, maxPanY), -maxPanY);
        modalImg.style.transform = `scale(${scale}) translate(${offsetX/scale}px,${offsetY/scale}px)`;
    });
    modalSlider.addEventListener('touchend', function(e){
        panStart = null;
    });
    let lastTap = 0;
    modalSlider.addEventListener('touchend', function(e){
        if (e.touches && e.touches.length > 0) return;
        const now = new Date().getTime();
        if (now - lastTap < 400) {
            if (!zoomed) {
                setZoomModal();
                zoomed = true;
                modalImg.classList.add('zoomed');
                modalImg.style.transform = `scale(${scale})`;
                modalImg.style.cursor = "grab";
                modalImg.style.transition = "transform 0.25s";
                offsetX = offsetY = 0;
            } else {
                resetModalZoom();
            }
        }
        lastTap = now;
    });

    document.getElementById('modalCloseBtn').onclick = closeModalGallery;
    document.getElementById('sliderPrev').onclick = () => {
        const planta = suculentas[currentModalIdx];
        currentPhotoIdx = (currentPhotoIdx - 1 + planta.fotos.length) % planta.fotos.length;
        updateModalSlider();
    };
    document.getElementById('sliderNext').onclick = () => {
        const planta = suculentas[currentModalIdx];
        currentPhotoIdx = (currentPhotoIdx + 1) % planta.fotos.length;
        updateModalSlider();
    };
    document.getElementById('modalOverlay').addEventListener('click', function(e){
        if(e.target === this) closeModalGallery();
    });
    window.addEventListener('keydown', function(e){
        const modal = document.getElementById('modalOverlay');
        if(modal.classList.contains('active')) {
            if(e.key === "Escape") closeModalGallery();
            if(e.key === "ArrowRight") document.getElementById('sliderNext').click();
            if(e.key === "ArrowLeft") document.getElementById('sliderPrev').click();
        }
    });
    </script>
</body>
</html>